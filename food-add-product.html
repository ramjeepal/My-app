<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>Food Seller Dashboard</title>
  <style>
    body { font-family: Arial, sans-serif; margin:0; padding:20px; background:#f5f5f5; }
    .container { max-width:500px; margin:auto; background:white; padding:20px; border-radius:12px; box-shadow:0 4px 10px rgba(0,0,0,0.1);}
    h2 { text-align:center; margin-bottom:20px; }
    input, textarea, button { width:100%; padding:12px; margin:10px 0; border:1px solid #ccc; border-radius:8px; font-size:16px; }
    button { background:#ff5722; color:white; border:none; cursor:pointer; }
    button:hover { background:#e64a19; }
    img.preview { max-width:100%; margin-top:10px; border-radius:8px; }
  </style>
</head>
<body>
  <div class="container">
    <h2>üç¥ Add Food Item</h2>
    <input type="text" id="foodName" placeholder="Food Name" required>
    <input type="number" id="foodPrice" placeholder="Price (‚Çπ)" required>
    <textarea id="foodDesc" placeholder="Description" required></textarea>
    <input type="file" id="foodImage" accept="image/*">
    <img id="preview" class="preview" style="display:none;"/>
    <button id="saveBtn">Save Food Item</button>
  </div>

  <script type="module">
    // Firebase SDK imports
    import { initializeApp } from "https://www.gstatic.com/firebasejs/12.2.1/firebase-app.js";
    import { getAnalytics } from "https://www.gstatic.com/firebasejs/12.2.1/firebase-analytics.js";
    import { getDatabase, ref, push, set } from "https://www.gstatic.com/firebasejs/12.2.1/firebase-database.js";
    import { getStorage, ref as sRef, uploadBytes, getDownloadURL } from "https://www.gstatic.com/firebasejs/12.2.1/firebase-storage.js";
    import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/12.2.1/firebase-auth.js";

    // Firebase Config (‚úÖ storageBucket fix ‡§ï‡§ø‡§Ø‡§æ ‡§ó‡§Ø‡§æ ‡§π‡•à)
    const firebaseConfig = {
      apiKey: "AIzaSyAsEVwwD0e26aJtcy0wLp-vW64QKeokTek",
      authDomain: "food-app-8cb8b.firebaseapp.com",
      databaseURL: "https://food-app-8cb8b-default-rtdb.asia-southeast1.firebasedatabase.app",
      projectId: "food-app-8cb8b",
      storageBucket: "food-app-8cb8b.appspot.com",
      messagingSenderId: "473386805089",
      appId: "1:473386805089:web:0100db7ff60e95f4598720",
      measurementId: "G-E42G8RRW9Y"
    };

    // Initialize Firebase
    const app = initializeApp(firebaseConfig);
    const analytics = getAnalytics(app);
    const db = getDatabase(app);
    const storage = getStorage(app);
    const auth = getAuth(app);

    // Image Preview
    const fileInput = document.getElementById("foodImage");
    const preview = document.getElementById("preview");
    let selectedFile = null;
    fileInput.addEventListener("change", (e)=>{
      selectedFile = e.target.files[0];
      if(selectedFile){
        preview.src = URL.createObjectURL(selectedFile);
        preview.style.display = "block";
      }
    });

    // Save Food Item
    document.getElementById("saveBtn").addEventListener("click", async ()=>{
      const name = document.getElementById("foodName").value;
      const price = document.getElementById("foodPrice").value;
      const desc = document.getElementById("foodDesc").value;

      if(!name || !price || !desc || !selectedFile){
        alert("Please fill all fields & select an image.");
        return;
      }

      try {
        // Upload image
        const imgRef = sRef(storage, "foodImages/" + Date.now() + "-" + selectedFile.name);
        await uploadBytes(imgRef, selectedFile);
        const downloadURL = await getDownloadURL(imgRef);

        // Push data into Realtime DB
        const productsRef = ref(db, "products");
        const newProdRef = push(productsRef);
        await set(newProdRef, {
          name: name,
          price: price,
          description: desc,
          imageUrl: downloadURL,
          sellerId: auth.currentUser ? auth.currentUser.uid : "guest",
          available: true
        });

        alert("‚úÖ Food item added successfully!");
        document.getElementById("foodName").value = "";
        document.getElementById("foodPrice").value = "";
        document.getElementById("foodDesc").value = "";
        fileInput.value = "";
        preview.style.display="none";
      } catch (err){
        console.error(err);
        alert("‚ùå Error: " + err.message);
      }
    });

  </script>
</body>
</html>